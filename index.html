<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCM Data Grouping Tool</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="js/app.js" defer></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>PCM Data Grouping Tool</h1>
            <p class="subtitle">Pipeline Current Mapping Analysis & Visualization</p>
        </div>
    </header>
    
    <nav class="main-nav">
        <ul>
            <li><a href="#data-input" class="active"><i class="fas fa-upload"></i> Data Input</a></li>
            <li><a href="#visualization"><i class="fas fa-chart-line"></i> Visualization</a></li>
            <li><a href="#grouping"><i class="fas fa-object-group"></i> Grouping</a></li>
            <li><a href="#reports"><i class="fas fa-download"></i> Export</a></li>
            <li><a href="#map"><i class="fas fa-map-marked-alt"></i> Map</a></li>
        </ul>
    </nav>
    
    <main>
        <section id="data-input" class="controls">
            <div class="section-header">
                <h2><i class="fas fa-upload"></i> Data Input</h2>
            </div>
            
            <div class="control-panel">
                <div class="file-input-container">
                    <div class="drag-drop-area" id="drag-drop-area">
                        <i class="fas fa-file-excel fa-3x"></i>
                        <p>Drag & drop your Excel file here<br>or click to browse</p>
                        <input type="file" id="file-input" accept=".xlsx" class="file-input">
                    </div>
                    <p class="file-status" id="file-status">No file selected</p>
                </div>
                
                <div class="data-selection-container" id="data-selection-container" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="rid-select">Select Data Set (RID):</label>
                        <select id="rid-select" class="form-control" disabled>
                            <option value="">-- Select a data set --</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>
        
        <div id="message-area" role="status" aria-live="polite"></div>
        
        <section id="visualization" class="visualization-section">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Data Visualization</h2>
            </div>
            
            <div class="visualization-controls">
                <button id="restore-points-btn" class="secondary-btn" disabled title="Restore all removed points">
                    <i class="fas fa-undo"></i> Restore Removed Points
                </button>
                <button id="fit-screen-btn" class="secondary-btn" style="display: none;" disabled title="Fit chart to screen">
                    <i class="fas fa-expand"></i> Fit to Screen
                </button>
                <p class="hint-text">Hold 'R' key and click on a point to remove it from the chart</p>
                <p class="hint-text">Double-click anywhere on the chart to reset zoom</p>
            </div>
            
            <div class="chart-container">
                <canvas id="data-chart"></canvas>
            </div>
        </section>
        
        <section id="grouping" class="grouping-section">
            <div class="section-header">
                <h2><i class="fas fa-object-group"></i> Grouping & Labeling</h2>
            </div>
            
            <div class="group-label-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="group-name">Group Name:</label>
                        <input type="text" id="group-name" placeholder="Enter group name" disabled>
                    </div>
                </div>
                
                <button id="apply-group-btn" class="secondary-btn" disabled>
                    <i class="fas fa-tag"></i> Apply to Selection
                </button>
                
                <p class="hint-text">Click and drag on the chart to select points, then apply a group name.</p>
            </div>
            
            <div class="group-visibility">
                <h3>Manage Groups</h3>
                <div id="group-toggles" class="toggle-container">
                    <p class="hint-text">No groups defined yet</p>
                </div>
            </div>
        </section>
        
        <section id="reports" class="reporting-section">
            <div class="section-header">
                <h2><i class="fas fa-download"></i> Export Data</h2>
            </div>
            
            <div class="export-controls">
                <div class="form-row">
                    <div class="form-group">
                        <label for="export-format">Export Format:</label>
                        <select id="export-format" disabled>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </div>
                
                <button id="download-btn" class="secondary-btn" disabled>
                    <i class="fas fa-download"></i> Download Data
                </button>
            </div>
            
            <div id="output-data" class="results-container">
                <div class="stats-summary">
                    <h3>Data Summary</h3>
                    <div class="stats-grid"></div>
                </div>
            </div>
        </section>
        
        <section id="map" class="map-section">
            <div class="section-header">
                <h2><i class="fas fa-map-marked-alt"></i> Geographic Visualization</h2>
            </div>
            
            <p class="map-instructions">View data points on the map (requires X and Y location data in Excel file)</p>
            <div id="data-map"></div>
        </section>
    </main>
    
    <footer>
        <div class="footer-content">
            <p>Lake Superior Consulting &copy; 2025</p>
            <div class="footer-links">
                <a href="#" id="help-link" title="Help"><i class="fas fa-question-circle"></i></a>
                <a href="#" id="info-link" title="About"><i class="fas fa-info-circle"></i></a>
            </div>
        </div>
    </footer>
    
    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-question-circle"></i> Help Guide</h3>
                <button class="modal-close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="help-section-intro">
                    <p>Welcome to the PCM Data Grouping Tool. This guide will help you understand how to use this powerful application effectively.</p>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-upload"></i> Data Upload</h4>
                    <div class="help-grid">
                        <div class="help-grid-item">
                            <div class="help-step"><span>1</span></div>
                            <p>Click "Select File" or drag & drop your Excel (.xlsx), CSV, or TXT file</p>
                        </div>
                        <div class="help-grid-item">
                            <div class="help-step"><span>2</span></div>
                            <p>The system will automatically parse and display your data</p>
                        </div>
                        <div class="help-grid-item">
                            <div class="help-step"><span>3</span></div>
                            <p>Select a data set (RID) if multiple sets are available</p>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-chart-line"></i> Data Visualization</h4>
                    <ul class="help-list">
                        <li>Use the parameter dropdown to switch between different data views</li>
                        <li>Data points are color-coded based on threshold and selection</li>
                        <li>Hold the 'R' key and click on points to remove them from the chart</li>
                        <li>Use the "Restore Removed Points" button to bring back any removed data</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-object-group"></i> Selecting & Grouping</h4>
                    <div class="help-grid">
                        <div class="help-grid-item">
                            <div class="help-step"><span>1</span></div>
                            <p>Click and drag on the chart to select points</p>
                        </div>
                        <div class="help-grid-item">
                            <div class="help-step"><span>2</span></div>
                            <p>Enter a group name in the field provided</p>
                        </div>
                        <div class="help-grid-item">
                            <div class="help-step"><span>3</span></div>
                            <p>Click "Apply to Selection" to create a custom group</p>
                        </div>
                    </div>
                    <p class="help-tip"><i class="fas fa-lightbulb"></i> Tip: Use the checkboxes under "Manage Groups" to toggle group visibility</p>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-download"></i> Exporting Data</h4>
                    <ul class="help-list">
                        <li>Choose your preferred format (Excel, CSV) from the dropdown</li>
                        <li>Click "Download Data" to export your data with all grouping information</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-map-marked-alt"></i> Geographic Map</h4>
                    <ul class="help-list">
                        <li>If your data includes X/Y coordinates, points will appear on the map</li>
                        <li>Click markers to see detailed information</li>
                        <li>Groups are color-coded consistently between chart and map</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h4>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <span class="key-combo">R + Click</span>
                            <span class="key-desc">Remove a data point</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key-combo">Shift + Drag</span>
                            <span class="key-desc">Remove points from selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key-combo">Esc</span>
                            <span class="key-desc">Clear current selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key-combo">Double-click</span>
                            <span class="key-desc">Reset chart zoom</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- About/Info Modal -->
    <div id="info-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> About This Tool</h3>
                <button class="modal-close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="info-section info-header">
                    <img src="LSC.png" alt="Lake Superior Consulting Logo" class="company-logo">
                    <h4>PCM Data Grouping Tool</h4>
                    <div class="version-badge">Version 2.1.0</div>
                    <p>A web-based tool for analyzing and grouping Pipeline Current Mapping (PCM) data with visualization, custom grouping, and geographic mapping capabilities.</p>
                </div>
                
                <div class="info-section">
                    <h4><i class="fas fa-star"></i> Key Features</h4>
                    <ul class="feature-list">
                        <li><i class="fas fa-chart-line"></i> Interactive data visualization</li>
                        <li><i class="fas fa-object-group"></i> Custom grouping of PCM data points</li>
                        <li><i class="fas fa-map-marked-alt"></i> Geographic mapping of data</li>
                        <li><i class="fas fa-download"></i> Multiple export formats</li>
                        <li><i class="fas fa-chart-bar"></i> Support for various data parameters</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h4><i class="fas fa-file-excel"></i> File Format Support</h4>
                    <p>This tool accepts Excel (.xlsx), CSV or TXT files with PCM data. Required columns include:</p>
                    <ul class="data-format-list">
                        <li><strong>MEAS:</strong> Station position (required)</li>
                        <li><strong>POINTTYPE:</strong> The point type (required)</li>
                        <li><strong>SIGNAL:</strong> The main value to analyze (required)</li>
                        <li><strong>X/Y:</strong> Coordinates for mapping (optional)</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h4><i class="fas fa-code"></i> Development</h4>
                    <p>Developed by Lake Superior Consulting's Engineering Software Solutions team</p>
                    <p>&copy; 2025 Lake Superior Consulting. All Rights Reserved.</p>
                    <p class="contact-info">For support, please contact <a href="mailto:support@lsconsulting.com">support@lsconsulting.com</a></p>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 